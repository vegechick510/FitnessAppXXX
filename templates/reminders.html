{% extends "layout.html" %}
{% block content %}
<div class="content-section d-flex justify-content-center min-vh-90 align-items-center">
    <form method="POST" name="reminderform">
        {{ form.hidden_tag() }}
        <fieldset class="form-group">
            <legend class="border-bottom mb-4">Remind Yourself!</legend>
            
            <!-- Display Form Errors (For Debugging) -->
            {% if form.errors %}
            <div class="alert alert-danger">
                <ul>
                {% for field, errors in form.errors.items() %}
                    {% for error in errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Date Display -->
            <div class="form-group">
                <label class="form-control-label">Date</label>
                <p class="form-control form-control-lg" name="time">{{ date }}</p>
            </div>
            
            <!-- Remainder Email Field -->
            <div class="form-group">
                {{ form.reminder_email.label(class="form-control-label") }}
                {{ form.reminder_email(class="form-control form-control-lg") }}
            </div>

            <!-- Reminder Type Selection -->
            <div class="form-group">                   
                {{ form.reminder_type.label(class="form-control-label") }}
                {{ form.reminder_type(class="form-control form-control-lg", , id="reminder_type") }}
            </div>

            <!-- Goal Reminder Fields (goal_start_date, goal_end_date, weight_goal) -->
            <div id="goal-fields" style="display: none;">
                <div class="form-group">
                    {{ form.goal_start_date.label(class="form-control-label") }}
                    {{ form.goal_start_date(class="form-control form-control-lg") }}
                </div>

                <div class="form-group">
                    {{ form.goal_end_date.label(class="form-control-label") }}
                    {{ form.goal_end_date(class="form-control form-control-lg") }}
                </div>

                <div class="form-group">
                    {{ form.weight_goal.label(class="form-control-label") }}
                    {{ form.weight_goal(class="form-control form-control-lg") }}
                </div>
            </div>

            <!-- Workout Reminder Fields (workouts, remind_time_ahead) -->
            <div id="workout-fields" style="display: none;">
                <!-- Workouts Selection -->
                <div class="form-group">
                    <label class="form-control-label">Select Workout</label>
                    {% if workout_list %}
                        <select class="form-control form-control-lg" name="workout">
                            {% for workout in workout_list %}
                                <option value="{{ workout.name }}">{{ workout.name }}</option>
                            {% endfor %}
                        </select>
                    {% else %}
                        <p class="text-muted">No workout available at this time.</p>
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.remind_time_ahead.label(class="form-control-label") }}
                    {{ form.remind_time_ahead(class="form-control form-control-lg") }}
                </div>

            </div>
        </fieldset>

        <!-- Submit Button -->
        <div class="form-group mb-4">
            {{ form.submit(class="btn btn-outline-info") }}
        </div>

    </form>
</div>

<!-- JavaScript for Conditional Display of Fields -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const reminderTypeField = document.querySelector('#reminder_type');
        const goalFields = document.getElementById('goal-fields');
        const workoutFields = document.getElementById('workout-fields');

        function toggleFields() {
            if (reminderTypeField.value === 'goal') {
                goalFields.style.display = 'none';
                workoutFields.style.display = 'block';
            } else if (reminderTypeField.value === 'workout') {
                goalFields.style.display = 'block';
                workoutFields.style.display = 'none';
            } else {
                goalFields.style.display = 'none';
                workoutFields.style.display = 'none';
            }
        }

        reminderTypeField.addEventListener('change', toggleFields);
        toggleFields(); // Initial toggle based on current selection
    });
</script>
{% endblock content %}
